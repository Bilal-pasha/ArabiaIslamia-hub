{
    email admin@example.com
}

# Path-based routing (single domain)
# For subdomain routing, replace :80 with your domain and add host matchers
:80 {
    # --- APIs ---
    handle /huffaz/api/* {
        uri strip_prefix /huffaz
        reverse_proxy huffaz-api:8001 {
            health_uri /health
            health_interval 30s
        }
    }
    handle /huffaz/health {
        reverse_proxy huffaz-api:8001
    }

    handle /secondary/api/* {
        uri strip_prefix /secondary
        reverse_proxy secondary-api:8002 {
            health_uri /health
            health_interval 30s
        }
    }
    handle /secondary/health {
        reverse_proxy secondary-api:8002
    }

    handle /health {
        respond "OK" 200
    }

    # --- Frontends (Next.js apps use basePath, pass full path) ---
    handle /huffaz/registration* {
        reverse_proxy huffaz-registration:3002
    }
    handle /huffaz/fees* {
        reverse_proxy huffaz-fees:3003
    }
    handle /huffaz/attendance* {
        reverse_proxy huffaz-attendance:3004
    }
    handle /huffaz* {
        reverse_proxy huffaz-hub:3001
    }

    handle /secondary/registration* {
        reverse_proxy secondary-registration:3012
    }
    handle /secondary/attendance* {
        reverse_proxy secondary-attendance:3014
    }
    handle /secondary* {
        reverse_proxy secondary-hub:3011
    }

    handle {
        reverse_proxy main-website:3000
    }

    encode gzip zstd
    header {
        X-Frame-Options "DENY"
        X-Content-Type-Options "nosniff"
        -Server
    }
    log {
        output file /var/log/caddy/backend.log
        format json
    }
}
