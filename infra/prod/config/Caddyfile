{
    email admin@example.com
}

# Path-based routing (single domain)
# For subdomain routing, replace :80 with your domain and add host matchers
:80 {
    # --- APIs ---
    handle /huffaz/api/* {
        uri strip_prefix /huffaz
        reverse_proxy huffaz-api:8001 {
            health_uri /health
            health_interval 30s
        }
    }
    handle /huffaz/health {
        reverse_proxy huffaz-api:8001
    }

    handle /secondary/api/* {
        uri strip_prefix /secondary
        reverse_proxy secondary-api:8002 {
            health_uri /health
            health_interval 30s
        }
    }
    handle /secondary/health {
        reverse_proxy secondary-api:8002
    }

    handle /health {
        respond "OK" 200
    }

    # --- Frontends (single app per school with basePath) ---
    handle /huffaz* {
        reverse_proxy huffaz-app:3001
    }

    handle /secondary* {
        reverse_proxy secondary-app:3011
    }

    handle {
        reverse_proxy main-website:3000
    }

    encode gzip zstd
    header {
        X-Frame-Options "DENY"
        X-Content-Type-Options "nosniff"
        -Server
    }
    log {
        output file /var/log/caddy/backend.log
        format json
    }
}
