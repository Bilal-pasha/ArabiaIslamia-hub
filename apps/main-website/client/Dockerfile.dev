FROM node:20-alpine
WORKDIR /app

# Enable pnpm
RUN corepack enable && corepack prepare pnpm@9.14.2 --activate

# --- Workspace root files (REQUIRED) ---
COPY pnpm-workspace.yaml package.json pnpm-lock.yaml* ./
COPY .npmrc* ./

# --- ONLY the packages used by main-website ---
COPY packages/database ./packages/database
COPY packages/storage ./packages/storage
COPY packages/ui ./packages/ui
COPY packages/animations ./packages/animations

# --- ONLY main-website app (api + client) ---
COPY apps/main-website/client ./apps/main-website/client

# Install from root workspace
RUN pnpm install --frozen-lockfile || pnpm install

# ---- START CLIENT CORRECTLY ----
WORKDIR /app/apps/main-website/client

EXPOSE 3000
CMD ["pnpm", "dev"]
